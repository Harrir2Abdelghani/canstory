services:
  - type: web
    name: canstory-backend
    env: node
    buildCommand: npm install --prefix web
    startCommand: node web/server.js
    rootDir: .
    envVars:
      - key: VITE_SUPABASE_URL
        value: https://mezoaqtjljcmbuanzzkj.supabase.co
      - key: VITE_SUPABASE_ANON_KEY
        value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lem9hcXRqbGpjbWJ1YW56emtqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0NDY2NjUsImV4cCI6MjA4NTAyMjY2NX0.huABGlQnNynr5ZrksSLBcRHUv8TEVGsxECz22L6_R2M
      - key: SUPABASE_SERVICE_ROLE_KEY
        value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lem9hcXRqbGpjbWJ1YW56emtqIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2OTQ0NjY2NSwiZXhwIjoyMDg1MDIyNjY1fQ.QxVtvMjn-x-bbGGATURYttmLi8fPDccLqCAEBpEiUfs
      - key: API_PORT
        value: 3001
      - key: NODE_ENV
        value: production

  - type: static_site
    name: canstory-frontend
    buildCommand: cd web && npm install && npm run build
    staticPublishPath: web/dist
    rootDir: .
    envVars:
      - key: VITE_API_BASE_URL
        value: https://canstory-backend.onrender.com
